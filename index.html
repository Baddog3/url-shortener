<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–°–æ–∫—Ä–∞—â–µ–Ω–∏–µ —Å—Å—ã–ª–æ–∫</title>

  <!--
    –≠—Ç–æ—Ç —Å–∞–π—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –±—Ä–∞—É–∑–µ—Ä–µ.
    –î–ª—è —Å–æ–∫—Ä–∞—â–µ–Ω–∏—è —Å—Å—ã–ª–æ–∫ –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ä–æ—Å—Å–∏–π—Å–∫–∏–π —Å–µ—Ä–≤–∏—Å clck.ru,
    –ø—Ä–∏ –æ—à–∏–±–∫–µ –µ—Å—Ç—å –∑–∞–ø–∞—Å–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç is.gd.
    –î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è QR-–∫–æ–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–µ–±–æ–ª—å—à–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ qrcodejs (—á–µ—Ä–µ–∑ CDN).
  -->

  <style>
    /* ===== –û–±—â–∏–µ —Å—Ç–∏–ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ===== */
    :root {
      --bg-color: #f5f5f5;
      --card-bg: #ffffff;
      --accent: #2563eb;
      --accent-hover: #1d4ed8;
      --text-main: #111827;
      --text-muted: #6b7280;
      --border-color: #e5e7eb;
      --error: #dc2626;
      --success: #16a34a;
      --radius: 12px;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 16px;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #e0f2fe 0, #f5f5f5 40%, #e5e7eb 100%);
      color: var(--text-main);
    }

    /* ===== –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è ===== */
    .app {
      width: 100%;
      max-width: 520px;
      background-color: var(--card-bg);
      border-radius: var(--radius);
      padding: 24px 20px 20px;
      box-shadow:
        0 18px 45px rgba(15, 23, 42, 0.15),
        0 0 0 1px rgba(148, 163, 184, 0.2);
    }

    .app__header {
      margin-bottom: 20px;
      text-align: center;
    }

    .app__title {
      margin: 0 0 4px;
      font-size: 1.4rem;
      font-weight: 600;
    }

    .app__subtitle {
      margin: 0;
      font-size: 0.9rem;
      color: var(--text-muted);
    }

    /* ===== –§–æ—Ä–º–∞ –≤–≤–æ–¥–∞ –¥–ª–∏–Ω–Ω–æ–π —Å—Å—ã–ª–∫–∏ ===== */
    .form-group {
      margin-bottom: 16px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .form-group__label {
      font-size: 0.9rem;
      color: var(--text-muted);
    }

    .row {
      display: flex;
      gap: 8px;
    }

    .row--stack-mobile {
      flex-direction: column;
    }

    @media (min-width: 520px) {
      .row--stack-mobile {
        flex-direction: row;
      }
    }

    .input {
      flex: 1;
      padding: 10px 12px;
      font-size: 0.95rem;
      border-radius: 999px;
      border: 1px solid var(--border-color);
      outline: none;
      transition: border-color 0.15s ease, box-shadow 0.15s ease, background-color 0.15s ease;
      background-color: #f9fafb;
    }

    .input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.2);
      background-color: #ffffff;
    }

    .button {
      border: none;
      border-radius: 999px;
      padding: 10px 16px;
      font-size: 0.95rem;
      font-weight: 500;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      transition: background-color 0.15s ease, box-shadow 0.15s ease, transform 0.05s ease;
      white-space: nowrap;
    }

    .button--primary {
      background-color: var(--accent);
      color: #ffffff;
      box-shadow: 0 10px 20px rgba(37, 99, 235, 0.35);
    }

    .button--primary:hover {
      background-color: var(--accent-hover);
      box-shadow: 0 12px 25px rgba(37, 99, 235, 0.45);
      transform: translateY(-1px);
    }

    .button--ghost {
      background-color: #f9fafb;
      color: var(--text-main);
      border: 1px solid var(--border-color);
    }

    .button--ghost:hover {
      background-color: #eef2ff;
      border-color: #c7d2fe;
    }

    .button:disabled {
      opacity: 0.6;
      cursor: default;
      box-shadow: none;
      transform: none;
    }

    .button__icon {
      font-size: 1.1rem;
      line-height: 1;
    }

    /* ===== –ë–ª–æ–∫ —Å –∫–æ—Ä–æ—Ç–∫–æ–π —Å—Å—ã–ª–∫–æ–π ===== */
    .result {
      margin-top: 16px;
      padding: 14px 14px 12px;
      border-radius: var(--radius);
      border: 1px dashed var(--border-color);
      background-color: #f9fafb;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .result__label {
      font-size: 0.85rem;
      color: var(--text-muted);
    }

    .result__row {
      display: flex;
      gap: 8px;
      flex-direction: column;
    }

    @media (min-width: 480px) {
      .result__row {
        flex-direction: row;
        align-items: center;
      }
    }

    .result__link-input {
      flex: 1;
      padding: 8px 10px;
      font-size: 0.9rem;
      border-radius: 999px;
      border: 1px solid var(--border-color);
      background-color: #ffffff;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .result__link-input[readonly] {
      cursor: text;
    }

    .helper-text {
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    /* ===== QR-–∫–æ–¥ ===== */
    .qr {
      margin-top: 16px;
      padding-top: 12px;
      border-top: 1px solid var(--border-color);
      display: none;
    }

    .qr--visible {
      display: block;
    }

    .qr__title {
      font-size: 0.9rem;
      color: var(--text-muted);
      margin-bottom: 8px;
    }

    .qr__box {
      display: inline-flex;
      padding: 10px;
      border-radius: 12px;
      border: 1px solid var(--border-color);
      background-color: #ffffff;
    }

    .qr__canvas {
      width: 140px;
      height: 140px;
    }

    /* ===== –°–æ–æ–±—â–µ–Ω–∏—è ===== */
    .message {
      margin-top: 8px;
      font-size: 0.85rem;
    }

    .message--error {
      color: var(--error);
    }

    .message--success {
      color: var(--success);
    }

    /* ===== –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ ===== */
    .stats {
      margin-top: 20px;
      padding-top: 16px;
      border-top: 1px solid var(--border-color);
    }

    .stats__title {
      margin: 0 0 10px;
      font-size: 1rem;
      font-weight: 600;
    }

    .stats__row {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      margin-bottom: 10px;
    }

    .stats__item {
      flex: 1 1 140px;
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid var(--border-color);
      background-color: #f9fafb;
    }

    .stats__value {
      font-size: 1.2rem;
      font-weight: 600;
    }

    .stats__label {
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    .stats__list-title {
      font-size: 0.85rem;
      color: var(--text-muted);
      margin-bottom: 4px;
    }

    .stats__list-items {
      list-style: none;
      padding: 0;
      margin: 0;
      display: flex;
      flex-direction: column;
      gap: 4px;
      max-height: 110px;
      overflow-y: auto;
    }

    .stats__list-item {
      font-size: 0.8rem;
      border-radius: 999px;
      border: 1px dashed var(--border-color);
      padding: 6px 10px;
      background-color: #ffffff;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .stats__list-item-main {
      display: flex;
      justify-content: space-between;
      gap: 6px;
      align-items: center;
    }

    .stats__list-short {
      font-weight: 500;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .stats__list-origin {
      color: var(--text-muted);
      font-size: 0.75rem;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
  </style>

  <!-- –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ QR-–∫–æ–¥–∞ -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js" defer></script>
</head>

<body>
  <main class="app">
    <header class="app__header">
      <h1 class="app__title">–°–æ–∫—Ä–∞—â–µ–Ω–∏–µ —Å—Å—ã–ª–æ–∫</h1>
      <p class="app__subtitle">–í—Å—Ç–∞–≤—å—Ç–µ –¥–ª–∏–Ω–Ω—ã–π URL, –ø–æ–ª—É—á–∏—Ç–µ –∫–æ—Ä–æ—Ç–∫—É—é —Å—Å—ã–ª–∫—É –∏ QR‚Äë–∫–æ–¥.</p>
    </header>

    <!--
      –ë–õ–û–ö –í–í–û–î–ê –°–°–´–õ–ö–ò
      - –ü–æ–ª–µ –≤–≤–æ–¥–∞ –¥–ª–∏–Ω–Ω–æ–π —Å—Å—ã–ª–∫–∏
      - –ö–Ω–æ–ø–∫–∞ "–°–æ–∫—Ä–∞—Ç–∏—Ç—å"
      - –ö–Ω–æ–ø–∫–∞ "–°–æ–∑–¥–∞—Ç—å QR –∫–æ–¥"
    -->
    <section aria-label="–°–æ–∫—Ä–∞—â–µ–Ω–∏–µ —Å—Å—ã–ª–∫–∏">
      <div class="form-group">
        <label class="form-group__label" for="longUrlInput">
          –í–∞—à–∞ –¥–ª–∏–Ω–Ω–∞—è —Å—Å—ã–ª–∫–∞
        </label>

        <div class="row row--stack-mobile">
          <input id="longUrlInput" class="input" type="url" placeholder="https://–ø—Ä–∏–º–µ—Ä-–¥–ª–∏–Ω–Ω–æ–π-—Å—Å—ã–ª–∫–∏..." />

          <button id="shortenBtn" class="button button--primary" type="button">
            <span class="button__icon">‚á£</span>
            <span>–°–æ–∫—Ä–∞—Ç–∏—Ç—å</span>
          </button>
        </div>

        <div class="row row--stack-mobile" style="margin-top: 8px;">
          <button id="qrBtn" class="button button--ghost" type="button">
            <span class="button__icon">‚ñ¢</span>
            <span>–°–æ–∑–¥–∞—Ç—å QR&nbsp;–∫–æ–¥</span>
          </button>
        </div>

        <p class="helper-text">
          –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –æ–±—ã—á–Ω—ã–µ —Å—Å—ã–ª–∫–∏ –≤–∏–¥–∞ <code>https://...</code>. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ –Ω–∞—á–∞–ª–µ –µ—Å—Ç—å
          <code>http://</code> –∏–ª–∏ <code>https://</code>.
        </p>
      </div>

      <!-- –í—ã–≤–æ–¥ –∫–æ—Ä–æ—Ç–∫–æ–π —Å—Å—ã–ª–∫–∏ -->
      <div class="result" aria-live="polite">
        <div class="result__label">–ö–æ—Ä–æ—Ç–∫–∞—è —Å—Å—ã–ª–∫–∞</div>

        <div class="result__row">
          <input id="shortUrlOutput" class="result__link-input" type="text" readonly
            placeholder="–ó–¥–µ—Å—å –ø–æ—è–≤–∏—Ç—Å—è –∫–æ—Ä–æ—Ç–∫–∞—è —Å—Å—ã–ª–∫–∞" />

          <button id="copyBtn" class="button button--ghost" type="button">
            <span class="button__icon">üìã</span>
            <span>–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</span>
          </button>
        </div>

        <p id="message" class="message" aria-live="polite"></p>

        <!-- –ë–ª–æ–∫ QR-–∫–æ–¥–∞ -->
        <div id="qrContainer" class="qr" aria-label="QR-–∫–æ–¥ –∫–æ—Ä–æ—Ç–∫–æ–π —Å—Å—ã–ª–∫–∏">
          <div class="qr__title">QR‚Äë–∫–æ–¥ –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –ø–æ –∫–æ—Ä–æ—Ç–∫–æ–π —Å—Å—ã–ª–∫–µ</div>
          <div class="qr__box">
            <div id="qrcode" class="qr__canvas"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- –ë–ª–æ–∫ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
    <section class="stats" aria-label="–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ —ç—Ç–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ">
      <h2 class="stats__title">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>

      <div class="stats__row">
        <div class="stats__item">
          <div id="statTotalShortened" class="stats__value">0</div>
          <div class="stats__label">–°—Å—ã–ª–æ–∫ —Å–æ–∫—Ä–∞—â–µ–Ω–æ</div>
        </div>

        <div class="stats__item">
          <div id="statQrGenerated" class="stats__value">0</div>
          <div class="stats__label">QR‚Äë–∫–æ–¥–æ–≤ —Å–æ–∑–¥–∞–Ω–æ</div>
        </div>
      </div>

      <div>
        <div class="stats__list-title">–ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ–∫—Ä–∞—â—ë–Ω–Ω—ã–µ —Å—Å—ã–ª–∫–∏ (–Ω–∞ —ç—Ç–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ)</div>
        <ul id="statLastList" class="stats__list-items"></ul>
      </div>
    </section>
  </main>

  <script>
    // ===== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò =====

    /**
     * –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –≤–≤–µ–¥—ë–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –≤—ã–≥–ª—è–¥–∏—Ç –∫–∞–∫ —Å—Å—ã–ª–∫–∞.
     * –ó–¥–µ—Å—å –ø—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞: —Å—Ç—Ä–æ–∫–∞ –¥–æ–ª–∂–Ω–∞ –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å http:// –∏–ª–∏ https://
     */
    function isValidUrl(value) {
      if (typeof value !== "string") return false;
      const trimmed = value.trim();
      return trimmed.startsWith("http://") || trimmed.startsWith("https://");
    }

    /**
     * –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–¥ –ø–æ–ª–µ–º –≤—ã–≤–æ–¥–∞.
     * type: "error" | "success" | "info"
     */
    function showMessage(text, type) {
      const messageEl = document.getElementById("message");
      if (!messageEl) return;

      messageEl.textContent = text;
      messageEl.className = "message"; // —Å–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—Ç–∞—Ä—ã–µ –∫–ª–∞—Å—Å—ã

      if (type === "error") {
        messageEl.classList.add("message--error");
      } else if (type === "success") {
        messageEl.classList.add("message--success");
      }
    }

    /**
     * –°–æ–∫—Ä–∞—â–µ–Ω–∏–µ —Å—Å—ã–ª–∫–∏ —á–µ—Ä–µ–∑ —Ä–æ—Å—Å–∏–π—Å–∫–∏–π —Å–µ—Ä–≤–∏—Å clck.ru.
     * –§–æ—Ä–º–∞—Ç –∑–∞–ø—Ä–æ—Å–∞:
     *   GET https://clck.ru/--?url=https://–ø—Ä–∏–º–µ—Ä.—Ä—É
     * –í –æ—Ç–≤–µ—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç –∫–æ—Ä–æ—Ç–∫–∞—è —Å—Å—ã–ª–∫–∞ –≤ –≤–∏–¥–µ –ø—Ä–æ—Å—Ç–æ–π —Å—Ç—Ä–æ–∫–∏.
     */
    async function shortenUrlWithClck(longUrl) {
      const encodedUrl = encodeURIComponent(longUrl.trim());
      const apiUrl = `https://clck.ru/--?url=${encodedUrl}`;

      const response = await fetch(apiUrl);

      if (!response.ok) {
        throw new Error("–°–µ—Ä–≤–∏—Å clck.ru —Å–µ–π—á–∞—Å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –ü–æ–ø—Ä–æ–±—É–µ–º –¥—Ä—É–≥–æ–π —Å–µ—Ä–≤–∏—Å.");
      }

      const text = (await response.text()).trim();

      if (!isValidUrl(text)) {
        throw new Error("clck.ru –≤–µ—Ä–Ω—É–ª –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç. –ü–æ–ø—Ä–æ–±—É–µ–º –¥—Ä—É–≥–æ–π —Å–µ—Ä–≤–∏—Å.");
      }

      return text; // –ø—Ä–∏–º–µ—Ä: https://clck.ru/XXXX
    }

    /**
     * –ó–∞–ø–∞—Å–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç —Å–æ–∫—Ä–∞—â–µ–Ω–∏—è —Å—Å—ã–ª–∫–∏ —á–µ—Ä–µ–∑ API is.gd.
     * –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: https://is.gd/apishorteningreference.php
     */
    async function shortenUrlWithIsGd(longUrl) {
      const encodedUrl = encodeURIComponent(longUrl.trim());
      const apiUrl = `https://is.gd/create.php?format=json&url=${encodedUrl}`;

      const response = await fetch(apiUrl);

      if (!response.ok) {
        throw new Error("–°–µ—Ä–≤–∏—Å is.gd —Å–µ–π—á–∞—Å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.");
      }

      const data = await response.json();

      if (data.errorcode) {
        const message = data.errormessage || "–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∫—Ä–∞—Ç–∏—Ç—å —Å—Å—ã–ª–∫—É —á–µ—Ä–µ–∑ is.gd.";
        throw new Error(message);
      }

      return data.shorturl;
    }

    /**
     * –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Å–æ–∫—Ä–∞—â–µ–Ω–∏—è —Å—Å—ã–ª–∫–∏.
     * –°–Ω–∞—á–∞–ª–∞ –ø—ã—Ç–∞–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–æ—Å—Å–∏–π—Å–∫–∏–π —Å–µ—Ä–≤–∏—Å clck.ru,
     * –µ—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∑–∞–ø–∞—Å–Ω–æ–π —Å–µ—Ä–≤–∏—Å is.gd.
     */
    async function shortenUrl(longUrl) {
      try {
        return await shortenUrlWithClck(longUrl);
      } catch (error) {
        console.warn(error);
      }

      // –ï—Å–ª–∏ clck.ru –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª, –ø—Ä–æ–±—É–µ–º is.gd
      return await shortenUrlWithIsGd(longUrl);
    }

    /**
     * –°–æ–∑–¥–∞–Ω–∏–µ –∏–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ QR-–∫–æ–¥–∞ –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ URL.
     * –ò—Å–ø–æ–ª—å–∑—É–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—ä–µ–∫—Ç QRCode (–±–∏–±–ª–∏–æ—Ç–µ–∫–∞ qrcodejs).
     */
    function createQrCode(url) {
      const qrContainer = document.getElementById("qrContainer");
      const qrElement = document.getElementById("qrcode");

      if (!qrContainer || !qrElement) return;

      // –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—ã–π QR-–∫–æ–¥, –µ—Å–ª–∏ –æ–Ω –±—ã–ª
      qrElement.innerHTML = "";

      // –°–æ–∑–¥–∞—ë–º –Ω–æ–≤—ã–π QR-–∫–æ–¥
      new QRCode(qrElement, {
        text: url,
        width: 140,
        height: 140,
        correctLevel: QRCode.CorrectLevel.H,
      });

      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±–ª–æ–∫ —Å QR-–∫–æ–¥–æ–º
      qrContainer.classList.add("qr--visible");
    }

    // ===== –ü–†–û–°–¢–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage) =====

    const STATS_STORAGE_KEY = "simpleLinkShortenerStatsV1";

    function loadStats() {
      try {
        const raw = localStorage.getItem(STATS_STORAGE_KEY);
        if (!raw) {
          return {
            totalShortened: 0,
            qrGenerated: 0,
            lastLinks: [],
          };
        }
        const parsed = JSON.parse(raw);
        return {
          totalShortened: parsed.totalShortened || 0,
          qrGenerated: parsed.qrGenerated || 0,
          lastLinks: Array.isArray(parsed.lastLinks) ? parsed.lastLinks : [],
        };
      } catch (e) {
        console.warn("–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É, –Ω–∞—á–Ω—ë–º —Å –Ω—É–ª—è.", e);
        return {
          totalShortened: 0,
          qrGenerated: 0,
          lastLinks: [],
        };
      }
    }

    function saveStats(stats) {
      try {
        localStorage.setItem(STATS_STORAGE_KEY, JSON.stringify(stats));
      } catch (e) {
        console.warn("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É.", e);
      }
    }

    function updateStatsUI(stats) {
      const totalShortenedEl = document.getElementById("statTotalShortened");
      const qrGeneratedEl = document.getElementById("statQrGenerated");
      const listEl = document.getElementById("statLastList");

      if (totalShortenedEl) {
        totalShortenedEl.textContent = String(stats.totalShortened);
      }

      if (qrGeneratedEl) {
        qrGeneratedEl.textContent = String(stats.qrGenerated);
      }

      if (listEl) {
        listEl.innerHTML = "";

        if (!stats.lastLinks.length) {
          const li = document.createElement("li");
          li.className = "stats__list-item";
          li.textContent = "–ü–æ–∫–∞ –Ω–µ—Ç —Å–æ–∫—Ä–∞—â—ë–Ω–Ω—ã—Ö —Å—Å—ã–ª–æ–∫.";
          listEl.appendChild(li);
          return;
        }

        stats.lastLinks.forEach(function (item) {
          const li = document.createElement("li");
          li.className = "stats__list-item";

          const mainRow = document.createElement("div");
          mainRow.className = "stats__list-item-main";

          const shortSpan = document.createElement("span");
          shortSpan.className = "stats__list-short";
          shortSpan.textContent = item.short;

          const timeSpan = document.createElement("span");
          timeSpan.className = "stats__list-time";
          timeSpan.style.fontSize = "0.7rem";
          timeSpan.style.color = "var(--text-muted)";
          timeSpan.textContent = item.time;

          mainRow.appendChild(shortSpan);
          mainRow.appendChild(timeSpan);

          const originDiv = document.createElement("div");
          originDiv.className = "stats__list-origin";
          originDiv.textContent = item.original;

          li.appendChild(mainRow);
          li.appendChild(originDiv);

          listEl.appendChild(li);
        });
      }
    }

    function formatTime(date) {
      const d = date instanceof Date ? date : new Date(date);
      const hours = String(d.getHours()).padStart(2, "0");
      const minutes = String(d.getMinutes()).padStart(2, "0");
      return `${hours}:${minutes}`;
    }

    function recordShorten(stats, longUrl, shortUrl) {
      const updated = Object.assign({}, stats);
      updated.totalShortened += 1;

      const newItem = {
        original: longUrl,
        short: shortUrl,
        time: formatTime(new Date()),
      };

      const MAX_ITEMS = 5;
      updated.lastLinks = [newItem].concat(updated.lastLinks || []).slice(0, MAX_ITEMS);

      saveStats(updated);
      updateStatsUI(updated);
      return updated;
    }

    function recordQrGenerated(stats) {
      const updated = Object.assign({}, stats);
      updated.qrGenerated += 1;
      saveStats(updated);
      updateStatsUI(updated);
      return updated;
    }

    // ===== –û–°–ù–û–í–ù–ê–Ø –õ–û–ì–ò–ö–ê –ü–†–ò –ó–ê–ì–†–£–ó–ö–ï –°–¢–†–ê–ù–ò–¶–´ =====
    window.addEventListener("DOMContentLoaded", function () {
      // –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã –æ–¥–∏–Ω —Ä–∞–∑
      const longUrlInput = document.getElementById("longUrlInput");
      const shortUrlOutput = document.getElementById("shortUrlOutput");
      const shortenBtn = document.getElementById("shortenBtn");
      const qrBtn = document.getElementById("qrBtn");
      const copyBtn = document.getElementById("copyBtn");
      const qrContainer = document.getElementById("qrContainer");

      // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
      let stats = loadStats();
      updateStatsUI(stats);

      if (!longUrlInput || !shortUrlOutput || !shortenBtn || !qrBtn || !copyBtn) {
        console.error("–ù–µ –Ω–∞–π–¥–µ–Ω –æ–¥–∏–Ω –∏–∑ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞.");
        return;
      }

      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ –∫–Ω–æ–ø–∫–µ "–°–æ–∫—Ä–∞—Ç–∏—Ç—å"
      shortenBtn.addEventListener("click", async function () {
        const longUrl = longUrlInput.value;

        // –°–∫—Ä—ã–≤–∞–µ–º QR-–∫–æ–¥ –ø—Ä–∏ –Ω–æ–≤–æ–º –∑–∞–ø—Ä–æ—Å–µ
        if (qrContainer) {
          qrContainer.classList.remove("qr--visible");
        }

        if (!isValidUrl(longUrl)) {
          showMessage("–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—Å—ã–ª–∫—É, –Ω–∞—á–∏–Ω–∞—é—â—É—é—Å—è —Å http:// –∏–ª–∏ https://", "error");
          shortUrlOutput.value = "";
          return;
        }

        // –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É –≤–æ –≤—Ä–µ–º—è –∑–∞–ø—Ä–æ—Å–∞
        shortenBtn.disabled = true;
        showMessage("–°–æ–∫—Ä–∞—â–∞–µ–º —Å—Å—ã–ª–∫—É...", "info");

        try {
          const shortUrl = await shortenUrl(longUrl);
          shortUrlOutput.value = shortUrl;
          showMessage("–°—Å—ã–ª–∫–∞ —É—Å–ø–µ—à–Ω–æ —Å–æ–∫—Ä–∞—â–µ–Ω–∞.", "success");

          // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
          stats = recordShorten(stats, longUrl, shortUrl);
        } catch (error) {
          console.error(error);
          showMessage(error.message || "–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∫—Ä–∞—â–µ–Ω–∏–∏ —Å—Å—ã–ª–∫–∏.", "error");
          shortUrlOutput.value = "";
        } finally {
          shortenBtn.disabled = false;
        }
      });

      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ –∫–Ω–æ–ø–∫–µ "–°–æ–∑–¥–∞—Ç—å QR –∫–æ–¥"
      qrBtn.addEventListener("click", function () {
        let urlForQr = "";

        // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –æ—Ç–¥–∞–µ–º –∫–æ—Ä–æ—Ç–∫–æ–π —Å—Å—ã–ª–∫–µ, –µ—Å–ª–∏ –æ–Ω–∞ –µ—Å—Ç—å
        if (shortUrlOutput.value && isValidUrl(shortUrlOutput.value)) {
          urlForQr = shortUrlOutput.value;
        } else if (longUrlInput.value && isValidUrl(longUrlInput.value)) {
          // –ï—Å–ª–∏ –∫–æ—Ä–æ—Ç–∫–æ–π –Ω–µ—Ç, –Ω–æ –µ—Å—Ç—å –≤–∞–ª–∏–¥–Ω–∞—è –¥–ª–∏–Ω–Ω–∞—è
          urlForQr = longUrlInput.value.trim();
        }

        if (!urlForQr) {
          showMessage("–°–Ω–∞—á–∞–ª–∞ –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—Å—ã–ª–∫—É –∏–ª–∏ —Å–æ–∫—Ä–∞—Ç–∏—Ç–µ –µ—ë.", "error");
          return;
        }

        createQrCode(urlForQr);
        showMessage("QR‚Äë–∫–æ–¥ —Å–æ–∑–¥–∞–Ω.", "success");

        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ QR-–∫–æ–¥–∞–º
        stats = recordQrGenerated(stats);
      });

      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ –∫–Ω–æ–ø–∫–µ "–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å"
      copyBtn.addEventListener("click", async function () {
        const value = shortUrlOutput.value.trim();

        if (!value) {
          showMessage("–ù–µ—Ç –∫–æ—Ä–æ—Ç–∫–æ–π —Å—Å—ã–ª–∫–∏ –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è.", "error");
          return;
        }

        try {
          if (navigator.clipboard && navigator.clipboard.writeText) {
            await navigator.clipboard.writeText(value);
            showMessage("–ö–æ—Ä–æ—Ç–∫–∞—è —Å—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞.", "success");
          } else {
            // –†–µ–∑–µ—Ä–≤–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤
            shortUrlOutput.select();
            document.execCommand("copy");
            showMessage("–ö–æ—Ä–æ—Ç–∫–∞—è —Å—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ (—á–µ—Ä–µ–∑ —Å—Ç–∞—Ä—ã–π –º–µ—Ç–æ–¥).", "success");
          }
        } catch (error) {
          console.error(error);
          showMessage("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –µ—ë –≤—Ä—É—á–Ω—É—é.", "error");
        }
      });

      // –ù–µ–±–æ–ª—å—à–æ–µ —É–¥–æ–±—Å—Ç–≤–æ: –ø–æ Enter –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞ –∑–∞–ø—É—Å–∫–∞—Ç—å —Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ
      longUrlInput.addEventListener("keyup", function (event) {
        if (event.key === "Enter") {
          shortenBtn.click();
        }
      });
    });
  </script>
</body>

</html>

